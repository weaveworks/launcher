ARG base_tag
FROM weaveworks/launcher-base:${base_tag} AS build

RUN make build/.agent.done

FROM alpine:3.14

COPY --from=build /go/src/github.com/weaveworks/launcher/build/agent /usr/bin/launcher-agent
COPY --from=build /go/src/github.com/weaveworks/launcher/build/kubectl /usr/bin/kubectl
WORKDIR /
ENTRYPOINT ["/usr/bin/launcher-agent"]
CMD ["-help"]

ARG revision
LABEL maintainer="Weaveworks <help@weave.works>" \
      org.opencontainers.image.title="launcher-agent" \
      org.opencontainers.image.source="https://github.com/weaveworks/launcher" \
      org.opencontainers.image.revision="${revision}" \
      org.opencontainers.image.vendor="Weaveworks"
